# 연관관계 매핑(2)

연관관계 매핑시 고려사항 3가지

- 다중성
- 단방향, 양방향
- 연관관계의 주인(양방향)



## 다대일(N:1)

앞에서 해본 것(Member - Team)

## 일대다(1:N)

객체와 관계형 데이터베이스 차이점

- 객체에서는 1:N으로 단방향 참조하는 경우도 있다
- 하지만 DB에서는 그 상황에서도 마찬가지로 FK를 '일'이 아니라 '다'에 넣는다.

권장하지 않음(김영한님 스타일)

- 객체에서는 '일'을 수정하지만 실제 DB에서는 '다'가 수정되기 때문이다.(연관관계의 주인이 '일', 외래 키는 '다')
- 그렇기 때문에 DB 관점에서 먼저 단방향으로 연결하고 역방향이 필요하면 따로 연결하여 양방향을 만들자.
- 유지보수 관점에서 ORM인데도 불구하고 DB에 신경써서 코딩을 하는게 좋다고 한다.

## 일대일(1:1)

외래 키가 어디에 들어가도 상관없음(대칭적이므로)

일대일이므로 unique 제약조건을 건다.

양방향은 다대일에서와 똑같이 하면 된다.(연관관계의 주인을 외래 키가 있는 곳으로 / 반대편은 mappedBy)

\* 요구사항에 따른 DB 설계(외래키를 어디에 두는지)

- unique 제약조건을 풀면 일대일을 다대일로 바꾸기 용이하다.
  - 외래 키가 Locker에 있는 경우 -> 하나의 Member가 여러 Locker를 가지도록 바꾸기 용이하다.
  - 외래 키가 Member에 있는 경우 -> 하나의 Locker가 여러 Member를 가지도록 바꾸기 용이하다.
- 비지니스 로직을 잘 살펴볼 때 Member를 selcet할 일이 더 많은 경우 -> Member가 FK를 가지고 있는게 성능상 좋다.

### 주 테이블에 외래 키

- 객체지향스럽다. -> JPA 매핑이 편리하다.
- 주테이블만 조회해도 대상 테이블에 데이터가 있는지 확인 가능하다
- 하지만 값이 없다면 주테이블에 null을 허용해야한다.

### 대상 테이블에 외래 키

- RDB스럽다.
- 일대일에서 일대다 관계로 변경할 때 용이하다.
- 양방향으로 만들어야하고 프록시 기능의 한계로 지연 로딩을 사용하지 못한다.(이해안됨)

## 다대다(N:M)

객체와 RDB와 패러다임이 너무 다르다

- 객체는 다대다 참조가 가능하다.
- RDB는 연결 테이블을 하나 만들어야한다.

@ManyToMany + @JoinTable

사용하지 않는게 좋다.

- DB 쿼리가 복잡해진다.
- 연결 테이블에 추가 속성을 못 넣는다. 실제 비지니스는 복잡해질 가능성이 높다.

연결 테이블을 엔티티로 만드는게 이해하기도 좋고 추가 속성을 넣기에도 편리하다.

- 다대일 두개로 다대다를 따라한다.



### 궁금한 점

왜 RDB를 써야만 하는가

ORM은 다 이런가