# 연관관계 매핑 기초

객체와 테이블 연관관계의 차이를 이해(객체의 참조 <-> 테이블의 외래 키)

## 단방향 연관관계

```java
// member
@ManyToOne
@JoinColumn(name = "TEAM_ID")
private Team team;
```

1. 어떤 관계인지
2. join하는 column이 무엇인지

실제 find하여 쿼리를 보면 join을 해서 select한다.



## 양방향 연관관계

객체는 단방향, 양방향에 차이가 있는데 테이블은 FK를 넣은 시점에서 양방향임(join 방향만 다름)

```java
// team
@OneToMany(mappedBy = "team")
List<Member> members = new ArrayList<Member>();
```

객체의 양방향은 사실상 단방향 두개

외래 키를 어느쪽에서 관리할지를 정해야함

**연관관계의 주인**

- 연관관계의 주인만이 외래 키를 관리
- 주인이 아닌쪽은 읽기만 가능
- 주인은 mappedBy 속성 X
- 주인이 아니면 mappedBy 속성으로 지정
- 외래 키가 있는 곳을 주인으로 하는게 이해하기 쉬움

**순수 객체 상태를 고려해서 항상 양쪽에 값을 설정하자**

- 연관관계의 주인만 수정하면 되지만 부자연스럽고 헷갈린다.
- 편의 메소드 : 양쪽에 값을 설정하는 메소드를 만들자(changeTeam)

**무한 루프 조심하자**

- ex) 서로 toString을 호출해서 무한루프
- toSring(), lombok, JSON 생성 라이브러리
- 반환을 entity로 반환하지 않고 dto로 하기만 해도 대부분의 문제가 해결된다.



처음에 단방향으로 설계하고 양방향은 기능을 추가하는 것

양방향은 개발의 편의를 위한 것, 사실은 단방향으로 다 할 수 있다.



### 궁금한 점

왜 속성 이름이 mappedBy인지

왜 연관관계의 주인이 아니라 자기 자신의 이름을 속성값으로 넣는지